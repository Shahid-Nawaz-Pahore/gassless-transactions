import { getModuleAddress } from './constants.js';
import { encodeFunctionData, toHex, zeroAddress, } from 'viem';
import { abi } from './abi.js';
export const getRecoveryConfig = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getRecoveryConfig',
            args: [account.address],
        });
    }
    catch (err) {
        return { delay: 0n, expiry: 0n };
    }
};
export const getRecoveryRequest = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getRecoveryRequest',
            args: [account.address],
        });
    }
    catch (err) {
        return [0n, 0n, 0n, toHex(0, { size: 32 })];
    }
};
export const getPreviousRecoveryRequest = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getPreviousRecoveryRequest',
            args: [account.address],
        });
    }
    catch (err) {
        return {
            previousGuardianInitiated: zeroAddress,
            cancelRecoveryCooldown: 0n,
        };
    }
};
export const isActivated = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'isActivated',
            args: [account.address],
        });
    }
    catch (err) {
        return false;
    }
};
export const canStartRecoveryRequest = async ({ account, client, validator, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'canStartRecoveryRequest',
            args: [account.address, validator],
        });
    }
    catch (err) {
        return false;
    }
};
export const getAllowValidatorRecoveryAction = async ({ client, validator, isInstalledContext, recoverySelector, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'allowValidatorRecovery',
        abi,
        args: [validator, isInstalledContext, recoverySelector],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getDisallowValidatorRecoveryAction = async ({ client, validator, prevValidator, recoverySelector, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'disallowValidatorRecovery',
        abi,
        args: [validator, prevValidator, recoverySelector],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getAllowedValidators = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getAllowedValidators',
            args: [account.address],
        });
    }
    catch (err) {
        return [];
    }
};
export const getAllowedSelectors = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getAllowedSelectors',
            args: [account.address],
        });
    }
    catch (err) {
        return [];
    }
};
export const acceptanceCommandTemplates = async ({ client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'acceptanceCommandTemplates',
        });
    }
    catch (err) {
        return [];
    }
};
export const recoveryCommandTemplates = async ({ client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'recoveryCommandTemplates',
        });
    }
    catch (err) {
        return [];
    }
};
export const extractRecoveredAccountFromAcceptanceCommand = async ({ client, commandParams, templateIdx, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'extractRecoveredAccountFromAcceptanceCommand',
            args: [commandParams, templateIdx],
        });
    }
    catch (err) {
        return zeroAddress;
    }
};
export const extractRecoveredAccountFromRecoveryCommand = async ({ client, commandParams, templateIdx, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'extractRecoveredAccountFromRecoveryCommand',
            args: [commandParams, templateIdx],
        });
    }
    catch (err) {
        return zeroAddress;
    }
};
export const computeAcceptanceTemplateId = async ({ client, templateIdx, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'computeAcceptanceTemplateId',
            args: [templateIdx],
        });
    }
    catch (err) {
        return 0n;
    }
};
export const computeRecoveryTemplateId = async ({ client, templateIdx, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'computeRecoveryTemplateId',
            args: [templateIdx],
        });
    }
    catch (err) {
        return 0n;
    }
};
export const getVerifier = async ({ client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'verifier',
        });
    }
    catch (err) {
        return zeroAddress;
    }
};
export const getDkim = async ({ client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'dkim',
        });
    }
    catch (err) {
        return zeroAddress;
    }
};
export const getEmailAuthImplementation = async ({ client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'emailAuthImplementation',
        });
    }
    catch (err) {
        return zeroAddress;
    }
};
export const getUpdateRecoveryConfigAction = async ({ client, delay, expiry, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'updateRecoveryConfig',
        abi,
        args: [{ delay, expiry }],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getHandleAcceptanceAction = async ({ client, emailAuthMsg, templateIdx, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'handleAcceptance',
        abi,
        args: [emailAuthMsg, templateIdx],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getHandleRecoveryAction = async ({ client, emailAuthMsg, templateIdx, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'handleRecovery',
        abi,
        args: [emailAuthMsg, templateIdx],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getCompleteRecoveryAction = async ({ client, account, recoveryData, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'completeRecovery',
        abi,
        args: [account, recoveryData],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getCancelRecoveryAction = async ({ client, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'cancelRecovery',
        abi,
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getCancelExpiredRecoveryAction = async ({ client, account, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'cancelExpiredRecovery',
        abi,
        args: [account],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const computeEmailAuthAddress = async ({ client, recoveredAccount, accountSalt, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'computeEmailAuthAddress',
            args: [recoveredAccount, accountSalt],
        });
    }
    catch (err) {
        return zeroAddress;
    }
};
export const getGuardianConfig = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getGuardianConfig',
            args: [account.address],
        });
    }
    catch (err) {
        return {
            guardianCount: 0n,
            totalWeight: 0n,
            acceptedWeight: 0n,
            threshold: 0n,
        };
    }
};
export const getGuardian = async ({ account, client, guardian, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getGuardian',
            args: [account.address, guardian],
        });
    }
    catch (err) {
        return { status: 0, weight: 0n };
    }
};
export const getAllGuardians = async ({ account, client, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'getAllGuardians',
            args: [account.address],
        });
    }
    catch (err) {
        return [];
    }
};
export const hasGuardianVoted = async ({ account, client, guardian, }) => {
    const address = getModuleAddress(await client.getChainId());
    try {
        return await client.readContract({
            address,
            abi,
            functionName: 'hasGuardianVoted',
            args: [account.address, guardian],
        });
    }
    catch (err) {
        return false;
    }
};
export const getAddGuardianAction = async ({ client, guardian, weight, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'addGuardian',
        abi,
        args: [guardian, weight],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getRemoveGuardianAction = async ({ client, guardian, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'removeGuardian',
        abi,
        args: [guardian],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
export const getChangeThresholdAction = async ({ client, threshold, }) => {
    const address = getModuleAddress(await client.getChainId());
    const data = encodeFunctionData({
        functionName: 'changeThreshold',
        abi,
        args: [threshold],
    });
    return {
        to: address,
        target: address,
        value: 0n,
        callData: data,
        data,
    };
};
//# sourceMappingURL=usage.js.map